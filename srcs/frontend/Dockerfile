FROM node:lts AS dev

RUN echo "dev"

WORKDIR /app/
RUN apt-get update && apt-get install -y curl

EXPOSE 3000

ENV REACT_APP_FORTYTWO_APP_ID=$REACT_APP_FORTYTWO_APP_ID
ENV REACT_APP_GITHUB_LINK=$REACT_APP_GITHUB_LINK
ENV REACT_APP_FRONTEND_URL=$REACT_APP_FRONTEND_URL
ENV REACT_APP_BACKEND_URL=$REACT_APP_FRONTEND_URL

RUN rm -rf nodes_modules

ENTRYPOINT ["sh", "-c", "npm i && npm start"]

FROM node:lts

CMD echo "prod"

WORKDIR /app/

ENV BUILD_PATH="/build/"

COPY . /app/

ENV REACT_APP_GITHUB_LINK=$REACT_APP_GITHUB_LINK
ENV REACT_APP_FRONTEND_URL=$REACT_APP_FRONTEND_URL
ENV REACT_APP_BACKEND_URL=$REACT_APP_FRONTEND_URL

RUN npm i
RUN npm run build
